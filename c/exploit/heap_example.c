/*
 * Example program for using heap memory allocation
 */
#include <stdio.h>
#include <stdlib.h>
#include <string.h>

int main(int argc, char *argv[]) {

	char *char_ptr; //char pointer
	int *int_ptr; // int pointer
	int mem_size;

	if (argc < 2)
		mem_size = 50;
	else
		mem_size = atoi(argv[1]);

	printf("\t[+] Allocating %d bytes of memory on the heap for char_ptr.\n", mem_size);
	char_ptr = (char *)malloc(mem_size); // allocate memory on the heap here

	if (char_ptr == NULL) { // Check for errors in mem allocation
		fprintf(stderr, "Error: could not allocate heap memory.\n");
		exit(-1);
	}

	strcpy(char_ptr, "This memory is located on the heap!.");
	printf("char_ptr (%p) --> '%s'\n", char_ptr, char_ptr);

	printf("\t[+] Allocating 12 bytes of memory on the heap for int_ptr.\n");
	int_ptr = (int *)malloc(12); // allocating heap memory again

	// Check for allocation errors again
	if (int_ptr == NULL) {
		fprintf(stderr, "Error: could not allocate heap memory.\n");
		exit(-1);
	}

	*int_ptr = 31337; // Put the value of 31337 where int_ptr is pointing
	printf("int_ptr (%p) --> '%d'\n", int_ptr, int_ptr);

	printf("\t[-] Freeing char_ptr's heap memory...\n");
	free(char_ptr); // Free heap memory

	printf("\t[+] Allocating 15 bytes for char_ptr.\n");
	char_ptr = (char *)malloc(15); //allocate new memory for char_ptr

	// Check for erros in memory allocation
	if (char_ptr == NULL) {
		fprintf(stderr, "Error: could not allocate heap memory.\n");
		exit(-1);
	}

	strcpy(char_ptr, "New Memory!");
	printf("char_ptr (%p) --> '%s'\n", char_ptr, char_ptr);

	printf("\t[-] Freeing int_ptr heap memory...\n");
	free(int_ptr);

	printf("\t[-] Freeing char_ptr heap memory ...\n");
	free(char_ptr);
}
